# リグレット解析の典型パターン（確率的K本腕バンディット / UCB系）

## 問題設定
- 腕 i = 1,...,K
- 報酬 X_{i,t} ∈ [0,1]（腕 i を引くたび i.i.d.）
- 期待値 μ_i
- 最適平均 μ* = max_i μ_i, 最適腕 i* ∈ argmax_i μ_i
- ギャップ Δ_i = μ* - μ_i（劣最適腕では Δ_i > 0）

累積リグレット：
R_T = Σ_{t=1}^T (μ* - μ_{I_t})
    = Σ_{i:Δ_i>0} Δ_i E[N_i(T)]
ここで N_i(T) は時刻 T までに腕 i を引いた回数。

## マスタープラン（UCB型）
目的：各劣最適腕 i について E[N_i(T)] を上から抑える。

### 1. 信頼半径（confidence radius）を定義
経験平均 \hat μ_i(s)（腕 i を s 回引いたとき）に対し
rad(s,t) = sqrt( (c log t) / (2 s) )
のような半径を置く（Hoeffding型）。UCB1では定数は典型的に c=2 など。

### 2. 「良い事象」を定義して確率を抑える
時刻 t における良い事象：
E_t := ⋂_{i=1}^K ⋂_{s=1}^{t} { | \hat μ_i(s) - μ_i | ≤ rad(s,t) }.
Hoeffding不等式＋合併界（union bound）で P(E_t^c) を小さく抑える。
（t に関して総和可能にして「悪い事象の寄与は定数」にするのが定番。）

### 3. 良い事象の下で「劣最適腕が選ばれる条件」を導く
UCBの定義：
UCB_i(t) = \hat μ_i(N_i(t-1)) + rad(N_i(t-1), t).

良い事象 E_t の下では
\hat μ_i ≤ μ_i + rad,   \hat μ_{i*} ≥ μ* - rad
が同時に成立。

もし時刻 t に劣最適腕 i が選ばれたなら
UCB_i(t) ≥ UCB_{i*}(t)
⇒ μ_i + 2 rad(N_i(t-1), t) ≥ μ*
⇒ 2 rad(N_i(t-1), t) ≥ Δ_i

つまり「腕 i の試行回数が十分大きいと 2 rad が Δ_i を下回り、以後は選ばれない」
という形になる。

### 4. 回数上界（pull counting）
閾値
m_i := ceil( (定数) * (log T) / Δ_i^2 )
を取ると、E_t が起きている限り N_i(t-1) ≥ m_i の状態では i は選ばれない。

したがって
N_i(T) ≤ m_i +（悪い事象 E_t^c の下で引かれた回数）
となり、期待値を取って
E[N_i(T)] ≤ m_i + Σ_{t=1}^T P(E_t^c)
を得る。後者は（設計次第で）O(1) にできる。

### 5. リグレット上界
R_T = Σ_i Δ_i E[N_i(T)] に代入して
R_T = O( Σ_{i:Δ_i>0} (log T)/Δ_i )
が得られる（定数は半径や合併界の取り方で変わる）。
